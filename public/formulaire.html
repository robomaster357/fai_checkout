<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Formulaire d’adhésion</title>
  <link rel="stylesheet" href="style_form.css">
  <!--<script src="script.js" defer></script>-->
</head>

<body>
  <form id="checkoutForm">
    <input type="text" id="firstName" placeholder="Prénom" required />
    <input type="text" id="lastName" placeholder="Nom" required />
    <input type="email" id="email" placeholder="Email" required />
    <input type="number" id="amount" placeholder="Montant en euros" required />
    <button type="submit">Payer</button>
  </form>

  <!-- Zone pour afficher les erreurs -->
  <div id="errorBox" style="color:red; margin-top: 1em;"></div>

  <script>
  document.getElementById("checkoutForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const errorBox = document.getElementById("errorBox");

    try {
      const data = Object.fromEntries(new FormData(e.target).entries());

      const response = await fetch("/api/helloasso/create-payment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (result.url) {
        // Rediriger vers HelloAsso pour payer
        window.location.href = result.url;
        console.log("✅ Paiement créé :", result);
      } else {
        errorBox.textContent = "Erreur de paiement : " + (result.error || "inconnue");
      }
    } catch (err) {
      errorBox.textContent = "Erreur serveur : " + err.message;
    }
  });
  </script>

  <style>
    #errorBox {
      color: white;
      background-color: red;
      padding: 0.5em;
      margin-top: 1em;
      font-weight: bold;
      border-radius: 4px;
    }

  </style>

</body>
</html>